const widthMobile=window.innerWidth>0?window.innerWidth:screen.width;function forceLayout(){const t=d3.select(".chart-force"),e=t.select("svg"),a=2,o=d3.scaleOrdinal(["#35618f","#70a5c1","#3444bc","#c8aee7","#c20da6","#ea88e2","#812050","#2eece6"]);function r(r){const s=t.node().offsetWidth;e.attr("width",s).attr("height",600);const c=e.selectAll(".circle").data(r).enter().append("circle").attr("class","circle").attr("r",t=>10*t.total).attr("fill",t=>o(t.nombre)).attr("cx",t=>t.x).attr("cy",t=>t.y);d3.forceSimulation().force("forceX",d3.forceX().x(.5*s)).force("forceY",d3.forceY().y(300)).force("center",d3.forceCenter().x(.5*s).y(300)).force("charge",d3.forceManyBody().strength(5)).force("collision",d3.forceCollide().radius(t=>10*t.total)).nodes(r).force("collide",d3.forceCollide().strength(.5).radius(t=>t.total+a).iterations(1)).on("tick",()=>c.attr("cx",({x:t})=>t).attr("cy",({y:t})=>t));const n=d3.group(r.map(t=>t.nombre));let i=n.filter((t,e)=>n.indexOf(t)===e);i=i.reverse(t=>t.nombre);const d=e.selectAll(".legend").remove().exit().data(i,t=>t).enter().append("g").attr("class","legend").attr("tema",t=>t);d.attr("transform",(t,e)=>`translate(50,${25*(e+5)})`),d.append("text").attr("x",20).attr("y",10).text(t=>t),d.append("rect").attr("width",10).attr("height",10).style("fill",t=>o(t))}window.addEventListener("resize",()=>{r(dataz)}),d3.csv("csv/total.csv",(t,e)=>{t?console.log(t):(dataz=e,dataz.forEach(t=>{t.nombre=t.nombre,t.total=+t.total,t.pp=+t.pp,t.psoe=+t.psoe,t.cs=+t.cs,t.up=+t.up}),r(dataz))})}function grid(t,e){const a=d3.select(`.grid-chart-${e}`),o=d3.select(".grid-charts"),r=d3_iconarray.layout().width(12).height(8),s=6,c={top:s,right:s,bottom:s,left:s},n=48,i=o.node().offsetWidth/3,d=d3.scaleLinear().range([0,i-(c.left+c.right)]).domain([0,12]),l=d3.select(`.container-political-${e}`).append("div").attr("class","tooltip").style("opacity",0);function p(t){a.selectAll(".temas").data(t).enter().append("div").attr("class",t=>t.key).call(function(t,e){r.widthFirst(e),t.append("h3").attr("class","tema-label").html(t=>t.key),t.append("svg").attr("width",i).attr("height",n).append("g").attr("transform",`translate(0,${c.top})`).attr("class","temas").selectAll("rect").data(t=>r(d3.range(0,t.values.length,1))).enter().append("rect").attr("class","rects").attr("x",t=>d(t.position.x)).attr("y",t=>d(t.position.y)).attr("rx",2.5).attr("ry",2.5).attr("fill","#780448").attr("width",2.5*s).attr("height",2.5*s).data(t=>t.values).on("click",t=>{l.attr("class",`tooltip ${t.party}`).style("opacity",0).transition().duration(300).style("opacity",1),l.html(`<h4 class="tooltip-party">${t.party}</h4>\n                            <span class="tooltip-candidate">${t.candidato}</span>\n                            <span class="tooltip-date">${t.date}</span>\n                            <p class="tooltip-text">${t.texto}</p>\n                            <a href="${t.fuente}" class="tooltip-source">Fuente</span>\n                            `)})},!0)}window.addEventListener("resize",()=>{p(dataz)}),d3.json(t).then(t=>{const e=t;e.forEach(t=>{t.partido=t.party,t.candidato=t.candidate,t.propuesta=t.proposal,t.fuente=t.source,t.tema=t.topic,t.texto=t.statement}),p(d3.nest().key(t=>t.tema).entries(e))})}grid(),forceLayout();const political=[["csv/partido-popular/partido-popular.json","pp"],["csv/partido-socialista/partido-socialista.json","psoe"],["csv/unidas-podemos/unidas-podemos.json","up"],["csv/ciudadanos/ciudadanos.json","cs"]];for(const t of political)grid(...t);